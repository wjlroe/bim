language: rust
os:
  - linux
rust: stable
cache:
  directories:
    - "$HOME/.cargo"
    - "$HOME/.multirust"
    - target
before_script:
  - export PATH="$PATH:$HOME/.cargo/bin"
  - curl https://pre-commit.com/install-local.py | python -
  - |
    if rustup self update 2>&1 | grep "rustfmt" > /dev/null; then
      echo 'rustfmt already installed via cargo, we will remove it'
      cargo uninstall rustfmt-nightly
    fi
  - rustup component add rustfmt-preview
script:
  - cargo fmt --version
  - pre-commit run --all-files
  - cargo build
  - cargo test
