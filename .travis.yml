language: c
os:
  - linux
  - osx
compiler:
  - clang
  - gcc
addons:
  apt:
    sources:
      - sourceline: 'ppa:duggan/bats'
    packages:
      - bats
      - xterm
cache: cargo
before_script:
  - rustup install stable
  - ./.travis/install.sh
  - export PATH="$PATH:$HOME/.cargo/bin"
  - curl http://pre-commit.com/install-local.py | python
  - rustup install nightly
  - rustup run nightly cargo install -f rustfmt-nightly
script:
  - rustup run nightly rustfmt --version
  - pre-commit run --all-files
  - make
  - ./.travis/test.sh
  - cargo fmt -- --write-mode=diff
  - cargo build
  - cargo test
